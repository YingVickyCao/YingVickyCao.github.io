# 组合模式 - 管理集合

# 1 Example

接着 迭代器模式 - Example 4

## Example 5 : 支持菜单中的菜单：加入甜点菜单，变成餐厅菜单集合的一个元素

因为目前的设计不能增加菜单和子菜单，所以要重新设计菜单。  
考虑：  
1）需要树形结构，可以容纳菜单、子菜单和菜单项。  
2）能在每个菜单的各个项之间游走，至少如想在用迭代器一样方便。  
3）更有弹性地 在菜单项目之间游走，e.g, 遍历甜点菜单，或遍历整个餐厅的整个菜单。

![Composite_Pattern_1](https://yingvickycao.github.io/img/Composite_Pattern_1.png)

---

![Composite_Pattern_2](https://yingvickycao.github.io/img/Composite_Pattern_2.png)

---

利用组合设计菜单：  
![Composite_Pattern_6 ](https://yingvickycao.github.io/img/Composite_Pattern_6.png)

---

运行时菜单组合：  
![Composite_Pattern_8](https://yingvickycao.github.io/img/Composite_Pattern_8.png)

组合模式以单一责任设计原则换取`透明性(transparency)`.
透明性：  
通过让组件的接口同时包含一些管理子节点和叶节点的操作，客户可以将组合和叶节点一视同仁，即一个元素是组合还是叶节点，对客户是透明的。

## Example 6 : + CompositeIterator 组合迭代器）

# 2 定义组合模式

> 组合模式：允许将对象组合成树形结构来表现“整体/部分”的层次结构。组合能够让客户以一致的方式处理个别对象以及对象组合。

组合模式让能用树形方式创建对象的结构，树里面包含了组合以及个别的对象。  
使用组合结构，能将相同的操作应用在组合和个别对象上，即：在大多数情况下，可以`忽略`对象组合和个别对象之间的差别。  
组合结构内的任意对象为组件，组件可以是组合，也可以是叶节点。  
在实际组合模式时，有很多设计上的折衷。根据需要平衡透明性和安全性。  
PS：虽然组合模式很智能，对客户透明。但代码并不好懂。

![Composite_Pattern_3](https://yingvickycao.github.io/img/Composite_Pattern_3.png)

---

![Composite_Pattern_4 ](https://yingvickycao.github.io/img/Composite_Pattern_4.png)

---

![Composite_Pattern_5 ](https://yingvickycao.github.io/img/Composite_Pattern_5.png)

## 类图

![Composite_Pattern_6 ](https://yingvickycao.github.io/img/Composite_Pattern_6.png)

- 空迭代器

## 详细分析组合模式：

- When use：  
  当有数个对象的集合，它们彼此之间有“整体/部分”的关系，并且想用一致的方式对待这些对象时。e.g, 顶层组件包含着其他组件，如按钮、滚动条等。当要显示它的时候，认为它是一个整体。告诉顶层的组件显示，然后放手不管，由顶层组件负责显示所有相关的部分。  
  这种包含其他组件的组件，叫组合对象（ViewGroup）。  
  没有包含其他组件的组件，叫业节点对象（Button）。

- “用一致的方式对待”？  
  组合和叶节点之间具有相同的方法可以调用。  
  可以叫组合对象显示，或叫叶节点对象显示，他们各自做出正确的事情。组合对象会叫它所有的组件显示。

- 每一个对象都具有相同的接口，但组合中有些对象行为不太一样，如何处理？  
  为了保持透明性，组合内所有对象必须实现相同的接口，否则客户必须操心哪个对象是用哪个相同的接口，这就失去了组合模式的意义。  
  当有些对象具备一些没有意义的方法调用时，通常这样处理：  
  1）让方法不做任何事  
  2）返回 nul 或 false  
  3）抛出异常  
  e.g,:

```java
public boolean isVegetarian() {
    throw new UnsupportedOperationException();
}
```

- 有些实际使用：对不同的对象使用不同的接口？  
  不会产生没有意义的方法调用。  
  这是更安全版本的组合模式。但需要客户先检查每个对象的类型，然后才能进行方法的调用。

- 组合和叶节点对象的结构  
  通常是用树形结构，即一种层次结构。  
  树是顶层的组合，然后往下是它的孩子，最末端是叶节点。

- 孩子会反向指向它的父亲吗？  
  可以。  
  组件可以有一个指向父亲的指针，以便在游走时更容易。  
  更容易处理：使用父亲从树形结构中删除这个孩子

- 孩子的次序？  
  当需要保持特定孩子次序的组合时，需要使用更复杂的管理方案来进行孩子的增加和删除，当在此层次结构内游走时，要更加小心。

- 缓存？  
  如果组合结构很复杂，或者遍历的代价太高，那么实现组合节点的缓存很有用。  
  e.g., 需要不断地遍历一个组合，而且它的每一个子节点都需要进行某些计算，那么，应该使用缓存来临时保存结果，省去遍历的开支。

- 组合模式的最大强项？  
  让客户调用更简单。  
  客户不需要关心面对是组合对象还是叶节点对象，这样省去了 if 判断，也能保证对正确的对象调用正确的方法。
