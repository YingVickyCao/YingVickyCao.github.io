# 第 15 章 总结

前面列出的技术仅仅只是一个起点，是登堂入室之前的大门，仅仅只是一个开始。 因为不知道何时应该使用它们、何时不应该使用；何时开始、何时停止；何时前进、何时等待。使重构能够成功的，不是前面各自独立的技术，而是这种节奏。  
=>孰能生巧，使用越多，体会和感悟越深。

如何知道自己已经“得道”：对自己的重构技术绝对自信——不论别人留下的代码多么的杂乱无章，你都能将它编号，好到足以进行后续开发。  
大多数时候，“得道”标志是：设定一个目标，你可以自信地停止重构。  
怎么停下来？如果代码比重构之前好，那么就把它继承到系统中，发布你的成果。如果代码并没有变好，就果断地放弃这些无用的工作，回到起始点。

重构是一种可以学习的技术，把这些技术集成一起并使之完善，就可以从新角度看待软件开发。

## 如何学习重构这门技术？

- (1) 随时挑一个目标。

某个地方的代码开始发臭时，应该将问题解决掉。应该朝该目标前进，达成目标后就停止。重构是为了让系统更容易理解，为了防止程序变得散乱。  
=> 随时重构，不要等有时间再重构这段代码。实际上，永远一直忙，永远没时间。时间久了，代码结构不再清晰、变得混乱了。

- (2) 没把握就停下来。

朝目标前进的过程中，可能会有这样的时候：你无法证明自己所做的一切能够保持程序原本的语义。此时应该停下来。如果代码已经比重构之前改善了，则把它集成到系统，发布成果。如果没有，则撤销所有修改。  
=> 重构再也无法前进一步，怎么办？ 果断停止。实际上经常会发生这种情况。

- (3) 学习原路返回。

重构的原则不好学，而且容易遗失准头。有时会连续做三项甚至思想重构，而且没有每次执行测试用例。当某个测试是失败时，却无法找到究竟哪一次修改造成这个问题。说明重构已经失控。

如何重新拿到控制权？  
应该回到最近一个没有出错的状态，然后逐一重复刚才做到的重构项，每次重构之后一定运行所有测试。  
=> 小步重构更安全，即使没有重构彻底，也要发布，起码代码可读性提高了。随时多次小步重构，就能逐渐提高代码可读性。  
=> Diff 工具 + GIt。 每个小步重构，测试或比较后没有问题，则执行 git add 操作，然后重新开始下一个 小步重构。  
=> 运行所有测试的结果如果很长，可以借助 Diff 工具比较重构是否正确。

- (4) 二重奏

和别人一起重构，可以收到更好地效果。两人结对，对于任何一种软件开发都有很多好处。对于重构也不例外。

结对重构的好处：  
重构时，时刻留意远景目标是有好处的。如果两人结伴，搭档可能看到你所没看到的东西，能想到你你没想到的事情。  
=> 自己写的代码太熟悉了，往往潜意识会忽略有些小错误。  
重构时，明智结束时有好处的。搭档不知道你在干什么就代表你不知道你在干什么，那么就应该结束重构。  
重构时，拥有绝对自信是绝对有好处的。结对重构，能给与鼓励。

与搭档协同工作的另一方面就是交谈。  
讲出你想做的事情，这样搭档能指出你的错误。  
交谈有助于了解如何让个别的重构项适应整个重构节奏。  
=> 通交谈，能更清楚地了解这部分功能，甚至发现隐藏的 bug。

重构不能把看到的所有问题都解决掉。大规模的重构只会带来灾难。  
正确的做法是：一点一点慢慢地解决这些问题。在添加新代码之前进行重构，能降低新增代码的风险。重构使得你更好理解代码的作用和工作方式，这使得新功能的添加更容易。重构之后的代码的质量会大大提高。

Keep in mind， 永远不往忘记“两项帽子”。

## Reference

- [http://blog.csdn.net/qq_22337877/article/details/73249912](http://blog.csdn.net/qq_22337877/article/details/73249912)
